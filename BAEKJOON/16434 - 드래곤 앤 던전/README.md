# 드래곤 앤 던전 문제 풀이 및 설명

<https://www.acmicpc.net/problem/16434>

<https://mayquartet.com/python-백준-16434-드래곤-앤-던전/>

## 문제 이해

이 문제는 용사가 던전에서 최종적으로 공주를 구하기 위해 필요한 최소한의 최대 생명력(`HMaxHP`)을 계산하는 문제입니다. 던전은 여러 개의 방으로 이루어져 있으며, 각 방에는 몬스터 또는 포션이 존재합니다. 용사는 방을 순서대로 통과해야 하며, 몬스터가 있는 방에서는 전투를 해야 하고, 포션이 있는 방에서는 생명력과 공격력을 증가시킬 수 있습니다. 이 과정에서 용사가 생존하기 위해 필요한 최소한의 최대 생명력을 찾아야 합니다.

문제의 핵심은 특정한 최대 생명력으로 던전을 모두 통과할 수 있는지를 확인하고, 이를 기반으로 최소의 최대 생명력을 계산하는 것입니다. 이 문제를 풀기 위해 던전의 각 방을 시뮬레이션하고, 이분 탐색을 통해 가능한 최소 생명력을 찾아야 합니다.

## 입출력 조건

### 입력 조건

1. 첫 번째 줄에는 방의 개수 `N`과 초기 공격력 `HATK`가 주어집니다.
   - `1 ≤ N ≤ 123,456`
   - `1 ≤ HATK ≤ 1,000,000`
2. 두 번째 줄부터 `N`개의 줄에 각 방의 정보가 주어집니다.
   - 방의 정보는 세 개의 정수 `t`, `a`, `h`로 구성됩니다.
   - `t`는 방의 유형을 나타내며, `1`은 몬스터 방, `2`는 포션 방입니다.
   - 몬스터 방(`t = 1`): `a`는 몬스터의 공격력, `h`는 몬스터의 생명력입니다.
   - 포션 방(`t = 2`): `a`는 공격력 증가량, `h`는 생명력 회복량입니다.
   - 모든 값은 `1 ≤ a, h ≤ 1,000,000`입니다.

### 출력 조건

- 용사가 최종적으로 공주를 구하기 위해 필요한 최소 `HMaxHP`를 출력합니다.
- 출력 값은 반드시 정수로 반환되어야 하며, 가능한 가장 작은 값이어야 합니다.

## 접근 방식

1. **이분 탐색의 적용**

   - 최소 `HMaxHP`를 찾기 위해 이분 탐색을 사용합니다.
   - 가능한 생명력 범위를 설정하고, 중간 값을 기준으로 던전을 통과할 수 있는지를 확인합니다.
   - 중간 값으로 던전을 통과할 수 있다면 더 작은 범위를 탐색하고, 통과할 수 없다면 더 큰 범위를 탐색합니다.

2. **던전 시뮬레이션**

   - 각 방의 유형에 따라 용사의 상태를 갱신합니다.
   - 몬스터 방에서는 몬스터의 공격력을 반영하여 용사의 생명력을 감소시킵니다. 용사의 생명력이 0 이하로 떨어지면 던전을 통과할 수 없습니다.
   - 포션 방에서는 용사의 생명력을 회복하고 공격력을 증가시킵니다. 이때 회복된 생명력은 최대 생명력을 초과할 수 없습니다.

3. **효율성 고려**
   - 최대 `N`개의 방을 시뮬레이션해야 하므로, 한 번의 검증에 `O(N)`의 시간이 소요됩니다.
   - 생명력 범위는 최대 `10^18`까지 가정할 수 있으므로, 이분 탐색의 시간 복잡도는 `O(log(10^18))`입니다.
   - 전체 시간 복잡도는 `O(N * log(10^18))`으로 충분히 효율적입니다.

<https://mayquartet.com/algorithm-binary-search/>

## 풀이 과정

1. **최대 생명력의 범위 설정**

   - 최소 `HMaxHP`는 `1`부터 시작하며, 최대값은 매우 큰 값 `10^18`으로 설정합니다.
   - 이 범위 내에서 이분 탐색을 수행합니다.

2. **중간값 검증**

   - 이분 탐색의 중간값을 `HMaxHP`로 설정하고, 해당 값으로 던전을 통과할 수 있는지 확인합니다.
   - 던전 통과 가능 여부를 확인하기 위해 각 방의 정보를 순차적으로 처리합니다.

3. **몬스터 방 처리**

   - 몬스터를 처치하는 데 필요한 용사의 공격 횟수를 계산합니다. 이는 `ceil(h / HATK)`으로 구할 수 있으며, Python에서는 `(h + HATK - 1) // HATK`로 계산할 수 있습니다.
   - 몬스터를 처치하는 동안 용사가 받는 총 피해를 계산하고, 현재 생명력에서 이를 차감합니다.
   - 생명력이 0 이하로 떨어지면 던전을 통과할 수 없으므로, `False`를 반환합니다.

4. **포션 방 처리**

   - 포션 방에서는 용사의 공격력을 증가시키고 생명력을 회복합니다.
   - 회복된 생명력은 최대 생명력을 초과하지 않도록 `min()` 함수로 처리합니다.

5. **결과 갱신**

   - 중간값으로 던전을 통과할 수 있다면 더 작은 값에서 정답을 찾기 위해 상한값을 줄입니다.
   - 통과할 수 없다면 더 큰 값에서 정답을 찾기 위해 하한값을 늘립니다.

6. **최종 결과 반환**
   - 이분 탐색이 종료되면 최종적으로 찾은 하한값이 최소 `HMaxHP`가 됩니다.
   - 이를 출력합니다.

## 코드 구현

```python
def minimum_max_hp(n, initial_atk, rooms):
    # 특정 HMaxHP로 던전을 돌파할 수 있는지 확인하는 함수
    def can_survive(hp):
        # 현재 생명력을 HMaxHP로 설정
        cur_hp = hp
        # 현재 공격력을 초기 공격력으로 설정
        cur_atk = initial_atk
        # 각 방을 순회하며 처리
        for t, a, h in rooms:
            if t == 1:  # 몬스터 방일 경우
                # 몬스터를 처치하기 위해 필요한 용사의 공격 횟수를 계산
                damage_to_take = (h + cur_atk - 1) // cur_atk - 1
                # 해당 횟수 동안 용사가 받는 데미지를 계산하여 현재 생명력에서 감소
                cur_hp -= damage_to_take * a
                # 생명력이 0 이하가 되면 던전을 돌파할 수 없음
                if cur_hp <= 0:
                    return False
            elif t == 2:  # 포션 방일 경우
                # 공격력을 증가시키고 생명력을 회복
                cur_atk += a
                cur_hp = min(hp, cur_hp + h)  # 최대 생명력을 초과하지 않도록 처리
        # 모든 방을 무사히 통과한 경우 True 반환
        return True

    # 이분 탐색의 범위를 설정 (최소값은 1, 최대값은 매우 큰 값 10^18)
    low, high = 1, 10**18

    # 이분 탐색을 통해 최소 HMaxHP를 찾음
    while low < high:
        # 중간 값을 계산
        mid = (low + high) // 2
        # 현재 중간 값으로 던전을 돌파할 수 있는지 확인
        if can_survive(mid):
            # 가능하다면 더 작은 값에서 정답을 찾기 위해 상한값을 줄임
            high = mid
        else:
            # 불가능하다면 더 큰 값에서 정답을 찾기 위해 하한값을 늘림
            low = mid + 1

    # 최소 HMaxHP를 반환
    return low

# 입력을 받아 던전의 방 수와 초기 공격력을 저장
n, initial_atk = map(int, input().split())

# 각 방의 정보를 리스트로 저장
rooms = [tuple(map(int, input().split())) for _ in range(n)]

# 최소 HMaxHP를 계산하고 출력
print(minimum_max_hp(n, initial_atk, rooms))
```
